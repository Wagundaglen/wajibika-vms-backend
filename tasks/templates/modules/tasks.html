{% extends 'base.html' %}
{% block title %}Tasks{% endblock %}
{% block content %}
<div class="container my-5">
    <h1 class="text-success"><i class="bi bi-list-task"></i> Tasks</h1>

    {# Filter dropdown for Admin & Coordinator #}
    {% if user.role == "Admin" or user.role == "Coordinator" %}
    <div class="mb-3">
        <form method="get" class="form-inline">
            <label for="status" class="mr-2">Filter by Acceptance:</label>
            <select name="status" id="status" class="form-control" onchange="this.form.submit()">
                <option value="">All</option>
                <option value="Pending" {% if filter_status == "Pending" %}selected{% endif %}>Pending</option>
                <option value="Accepted" {% if filter_status == "Accepted" %}selected{% endif %}>Accepted</option>
                <option value="Rejected" {% if filter_status == "Rejected" %}selected{% endif %}>Rejected</option>
            </select>
        </form>
    </div>
    <a href="{% url 'create_task' %}" class="btn btn-success mb-3">âž• Create Task</a>
    {% endif %}

    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Title</th>
                <th>Assigned To</th>
                <th>Due Date</th>
                <th>Status</th>
                <th>Acceptance</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td>{{ task.title }}</td>
                <td>{{ task.assigned_to.get_full_name }} ({{ task.assigned_to.role }})</td>
                <td>{{ task.due_date }}</td>
                <td>{{ task.status }}</td>
                <td>{{ task.acceptance_status }}</td>
                <td>
                    {% if user.role == "Admin" or user.role == "Coordinator" %}
                        <a href="{% url 'edit_task' task.id %}" class="btn btn-warning btn-sm">Edit</a>
                        <a href="{% url 'delete_task' task.id %}" class="btn btn-danger btn-sm"
                           onclick="return confirm('Are you sure you want to delete this task?');">Delete</a>
                    {% elif user.role == "Volunteer" and task.acceptance_status == "Pending" %}
                        <a href="{% url 'accept_task' task.id %}" class="btn btn-success btn-sm"
                           onclick="return confirm('Accept this task?');">Accept</a>
                        <a href="{% url 'reject_task' task.id %}" class="btn btn-danger btn-sm"
                           onclick="return confirm('Reject this task?');">Reject</a>
                    {% else %}
                        <span class="text-muted">No actions</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center">No tasks found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
